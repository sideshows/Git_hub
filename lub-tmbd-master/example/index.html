<!DOCTYPE html>
<html data-ng-app='lub-tmdb-example'>
<head>
    <meta charset="utf-8">
    <title>lub-tmdb-examples</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <style>

        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }

    </style>
</head>
<body>
<div class="container">

    <div class="row" ng-controller="SearchCtrl">

            <h1>SEARCH</h1>

            <form class="form-search" ng-submit='exec("search","movie",query)'>
                <input type="text" ng-model="query">
                <button class="btn" type="submit">Search Movie</button>
            </form>

        <div class="span6">
            <h1>RAW Search Results</h1>

            <p>
            <pre>{{searchResult}}</pre>
            </p>
        </div>
        <div class="row">
            <div class="span12">
            </div>
        </div>
    </div>

</div>
<style>
    label {
        padding: 0 10px;
    }
</style>
<script src="../test/lib/angular.1.1.1.js"></script>
<script src="../build/lub-tmdb.js"></script>
<script>
    var app = angular.module('lub-tmdb-example', ['lub-tmdb-api'])
            .value('lubTmdbApiKey', '9f6756ddede76f76a1ad744ccd5a3d48');
    app.controller('SearchCtrl', function ($scope, lubTmdbApi) {
        var suc = function (results) {
            $scope.searchResult = angular.toJson(results, true);
        };
        var err = function (results) {
            $scope.searchResult = results;
        };
        $scope.exec = function(type,method,query){
            lubTmdbApi[type][method]({
                query: query
            }).then(suc,err);
        }

        $scope.movieInfos = function () {
            var rename = {
                alternativeTitles:'alternative_titles',
                similarMovies:'similar_movies',
                nowPlaying:'now_playing',
                topRated:'top_rated'
            }
            var needsNoIdentifier = ['latest', 'upcoming', 'nowPlaying', 'popular', 'topRated'];
            var action, append_to_response = [];
            angular.forEach($scope.movie, function (value, key) {
                if (value && !action) {
                    action = key;
                } else if (value && action) {
                    if (rename[key]) {
                        append_to_response.push(rename[key]);
                    } else {
                        append_to_response.push(key);
                    }
                }
            });
            if (!action) {
                action = 'movie';
            }
            if (needsNoIdentifier.indexOf(action) >= 0) {
                lubTmdbApi.movie[action]({params: {
                    append_to_response:append_to_response.join(',')
                }}).then(suc, err);
            } else {
                lubTmdbApi.movie[action]({
                    query: $scope.identifier,
                    params: {append_to_response:append_to_response.join(',')}
                }).then(suc, err);
            }
        }
    });
</script>
</body>
</html>
